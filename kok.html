<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Extension Stress Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        button {
            margin: 10px;
            padding: 10px;
            font-size: 16px;
            cursor: pointer;
        }
        h1 {
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <h1>Extension Stress Test</h1>

    <!-- Buttons to trigger different overloads -->
    <button onclick="overloadEvents()">Overload Events</button>
    <button onclick="floodLocalStorage()">Flood LocalStorage</button>
    <button onclick="leakMemory()">Start Memory Leak</button>
    <button onclick="floodMessages()">Flood Extension with Messages</button>
    <button onclick="openTabs()">Open Many Tabs</button>
    <button onclick="runAll()">Run All Tests</button> <!-- New button -->

    <!-- Optional: Attempt to load extension script (only works under specific conditions) -->
    <script src="chrome-extension://adkcpkpghahmbopkjchobieckeoaoeem/main.js"></script>

    <script>
        // 1. Overload the Extension with Events or Requests
        function overloadEvents() {
            const container = document.body;
            const observer = new MutationObserver(() => {
                const newDiv = document.createElement("div");
                newDiv.style.width = '100px';
                newDiv.style.height = '100px';
                newDiv.style.backgroundColor = 'red';
                container.appendChild(newDiv);
            });

            observer.observe(container, { childList: true });

            setInterval(() => {
                const newDiv = document.createElement("div");
                newDiv.style.width = '100px';
                newDiv.style.height = '100px';
                newDiv.style.backgroundColor = 'red';
                container.appendChild(newDiv);
            }, 0);
        }

        // 2. Flood LocalStorage
        function floodLocalStorage() {
            for (let i = 0; i < 100000; i++) {
                localStorage.setItem(`key${i}`, 'a'.repeat(1000));
            }
            alert("LocalStorage flooded!");
        }

        // 3. Trigger Memory Leaks via Content Scripts
        function leakMemory() {
            let leakArray = [];
            setInterval(() => {
                leakArray.push(new Array(10000).join('x'));
                console.log('Memory leak: ', leakArray.length);
            }, 100);
        }

        // 5. Extension Messaging Abuse
        function floodMessages() {
            for (let i = 0; i < 1000; i++) {
                console.log("Sending message to extension: ", i);
                // Uncomment if the extension is configured to receive messages
                // chrome.runtime.sendMessage("adkcpkpghahmbopkjchobieckeoaoeem", { action: 'flood', data: i });
            }
        }

        // 6. Abuse Bad Permission Handling (Open Many Tabs)
        function openTabs() {
            for (let i = 0; i < 50; i++) {
                window.open("https://www.example.com", '_blank');
            }
        }

        // Run all functions together
        function runAll() {
            overloadEvents();
            floodLocalStorage();
            leakMemory();
            floodMessages();
            openTabs();
        }
    </script>
</body>
</html>
